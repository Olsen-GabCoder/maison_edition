<!-- src/app/features/user/pages/user-orders/user-orders.component.html -->
<div class="user-orders-container">

  <!-- Utilisation de la classe d'en-tête stylisée -->
  <div class="page-header">
    <h2>Mes Commandes</h2>
  </div>

  <!-- ===> AJOUT N°1 : Section des Totaux <=== -->
  <!-- Afficher seulement après chargement, sans erreur, et si des commandes existent -->
  <div *ngIf="!isLoading && !errorMessage && totalOrderCount > 0" class="order-summary-totals">
      <span>Total Commandes : <strong>{{ totalOrderCount }}</strong></span>
      <span>Montant Cumulé : <strong>{{ cumulativeTotalPrice | currency:'EUR':'symbol' }}</strong></span>
  </div>
  <!-- Séparateur optionnel si des commandes existent -->
  <hr *ngIf="!isLoading && !errorMessage && totalOrderCount > 0" class="totals-separator">
  <!-- ===> FIN AJOUT N°1 <=== -->


  <!-- Indicateur de chargement -->
  <div *ngIf="isLoading" class="loading-indicator">
    Chargement de votre historique de commandes...
  </div>

  <!-- Affichage d'erreur -->
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">
    {{ errorMessage }}
  </div>

  <!-- Conteneur principal si pas de chargement et pas d'erreur -->
  <!-- Note: Le *ngIf ici pourrait être redondant si on gère bien l'erreur avant -->
  <div *ngIf="!isLoading && !errorMessage">
    <!-- Abonnement à l'observable des commandes utilisateur -->
    <div *ngIf="(userOrders$ | async) as orders; else noOrdersYetTemplateFromAsync">
      <!-- Vérifier s'il y a des commandes -->
      <!-- Note: On pourrait utiliser totalOrderCount > 0 ici aussi -->
      <div *ngIf="orders.length > 0; else noOrdersYetContent">

        <p *ngIf="totalOrderCount > 0" style="text-align: center; margin-bottom: 20px; color: #6c757d;">
            Voici la liste des commandes que vous avez passées (enregistrées dans ce navigateur).
        </p>

        <!-- VOTRE STRUCTURE DE LISTE EN GRID (qui fonctionne) -->
        <div class="order-list">
          <div class="order-item" *ngFor="let order of orders">
            <div class="order-header">
              <span class="order-number" title="Numéro de Commande">{{ order.orderNumber }}</span>
              <span class="order-date" title="Date de la commande">{{ order.orderDate | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>
            <div class="order-details">
              <p><strong>Client :</strong> {{ order.customerName }}</p>
              <p><strong>Email :</strong> {{ order.customerEmail }}</p>
              <p *ngIf="order.items && order.items.length > 0">
                 <strong>Article(s):</strong>
                 <span *ngFor="let item of order.items; let last = last">
                     {{ item.title }} ({{ item.quantity }}){{ last ? '' : ', ' }}
                 </span>
              </p>
            </div>
            <div class="order-footer">
              <span class="order-total" title="Montant Total">{{ order.totalAmount | currency:'EUR':'symbol' }}</span>
              <span title="Statut de la commande" [class]="'order-status ' + getStatusBadgeClass(order.status)">
                {{ statusTranslations[order.status] || order.status }}
              </span>
            </div>
            <!-- Bouton détails optionnel -->
          </div> <!-- Fin .order-item -->
        </div> <!-- Fin .order-list -->
        <!-- FIN DE VOTRE STRUCTURE DE LISTE EN GRID -->

      </div> <!-- Fin *ngIf orders.length > 0 -->

       <!-- Template si orders.length est 0 après résolution -->
       <ng-template #noOrdersYetContent>
         <p class="no-orders-message">
           Vous n'avez pas encore passé de commande depuis ce navigateur.
         </p>
       </ng-template>

    </div> <!-- Fin *ngIf userOrders$ | async -->

     <!-- Template si userOrders$ n'émet jamais (ne devrait pas arriver) -->
     <ng-template #noOrdersYetTemplateFromAsync>
         <p *ngIf="!isLoading" class="no-orders-message">Aucune commande à afficher.</p>
     </ng-template>

  </div> <!-- Fin *ngIf !isLoading && !errorMessage -->

</div> <!-- Fin .user-orders-container -->