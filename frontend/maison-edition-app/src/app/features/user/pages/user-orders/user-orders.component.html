<!-- src/app/features/user/pages/user-orders/user-orders.component.html -->
<div class="user-orders-container">

  <div class="page-header">
    <h2>Mes Commandes</h2>
  </div>

  <!-- Section des Totaux (inchangée) -->
  <div *ngIf="!isLoading && !errorMessage && totalItemsCount > 0" class="order-summary-totals">
      <span>Total Articles Commandés : <strong>{{ totalItemsCount }}</strong></span>
      <span>Montant Cumulé Total : <strong>{{ cumulativeTotalPrice | currency:'EUR':'symbol' }}</strong></span>
  </div>
  <hr *ngIf="!isLoading && !errorMessage && totalItemsCount > 0" class="totals-separator">
  <!-- Fin Section Totaux -->

  <!-- Chargement/Erreur (inchangés) -->
  <div *ngIf="isLoading" class="loading-indicator">Chargement...</div>
  <div *ngIf="errorMessage && !isLoading" class="alert alert-danger">{{ errorMessage }}</div>
  <!-- Fin Chargement/Erreur -->

  <div *ngIf="!isLoading && !errorMessage">
    <div *ngIf="groupedOrders.length > 0; else noOrdersYetContent">

        <!-- Texte d'introduction (inchangé) -->
        <p *ngIf="totalItemsCount > 0" style="text-align: center; margin-bottom: 20px; color: #6c757d;">
            Voici le résumé de vos {{ totalItemsCount }} article(s) commandé(s) par titre (enregistrés dans ce navigateur).
        </p>

        <div class="order-list">
          <div class="order-item" *ngFor="let group of groupedOrders">

            <!-- En-tête de la carte (inchangé) -->
            <div class="order-header">
              <span class="order-number" title="Livre">{{ group.title }}</span>
              <span class="order-date" title="Dernière commande de cet article">{{ group.latestOrderDate | date:'dd/MM/yyyy HH:mm' }}</span>
            </div>

            <!-- Détails dans la carte (MODIFIÉ: Remplacement Référence par N° Cmd) -->
            <div class="order-details">
               <!-- ===> MODIFICATION: Afficher latestOrderNumber au lieu de bookId <=== -->
               <p><strong>N° Commande (dernière) :</strong> {{ group.latestOrderNumber }}</p>
               <!-- ===> FIN MODIFICATION <=== -->
               <p><strong>Prix Unitaire :</strong> {{ group.unitPrice | currency:'EUR':'symbol' }}</p>
               <p><strong>Quantité Totale :</strong> {{ group.totalQuantity }}</p>
               <p><strong>Client :</strong> {{ group.customerName }}</p>
               <p><strong>Email :</strong> {{ group.customerEmail }}</p>
            </div>

            <!-- Pied de page de la carte (inchangé) -->
            <div class="order-footer">
              <span class="order-total" title="Montant total pour cet article">{{ group.totalGroupPrice | currency:'EUR':'symbol' }}</span>
              <span title="Statut (dernière commande)" [class]="'order-status ' + getStatusBadgeClass(group.latestStatus)">
                {{ statusTranslations[group.latestStatus] || group.latestStatus }}
              </span>
            </div>

          </div> <!-- Fin .order-item -->
        </div> <!-- Fin .order-list -->

    </div>

    <!-- Template si groupedOrders est vide (inchangé) -->
    <ng-template #noOrdersYetContent>
      <p class="no-orders-message">
        Vous n'avez pas encore passé de commande depuis ce navigateur.
      </p>
    </ng-template>

  </div> <!-- Fin *ngIf !isLoading && !errorMessage -->

</div> <!-- Fin .user-orders-container -->